

<!doctype html>
<html class="no-js" lang="utf-8">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/main.css">

		<!--Main JS-->
        <script type="text/javascript" src="js/tabletop/examples/common/jquery.js"></script>
    	<script type="text/javascript" src="js/tabletop/examples/common/underscore.js"></script>
    	<script type="text/javascript" src="js/tabletop/examples/backbone/backbone.js"></script>
    	<script type="text/javascript" src="js/tabletop/src/backbone.tabletopSync.js"></script>
    	<script type="text/javascript" src="js/tabletop/src/tabletop.js"></script>
    	<script type="text/javascript"></script>
    </head>	
    <body>
	    <h1>A Backbone.js example</h1>

	    <script id="cam-template" type="text/underscore-template">
	      <div class="entry">
	        <h2><%= Name %></h2>	        
	      </div>
	    </script>

	    <div id="content"></div>

	    <script type="text/javascript">
	      var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1jspbTfijbvU7FUhICp6rXZfOXs6avxpBifLdxoYXj-E/pubhtml';
	        
	      /* 
	        You need to declare the tabletop instance separately, then feed it into the model/collection
	        You *must* specify wait: true so that it doesn't try to fetch when you initialize
	      */
	      var storage = Tabletop.init( { key: public_spreadsheet_url,
	                                      wait: true } )

	      /*
	       Need to specify that you'd like to sync using Backbone.tabletopSync
	       Can specify tabletop attributes, or you can do it on the collection
	      */
	      var Cam = Backbone.Model.extend({
	        idAttribute: 'Name',
	        tabletop: {
	          instance: storage,
	          sheet: 'DucaCamChart'
	        },
	        sync: Backbone.tabletopSync
	      })

	      /*
	       Need to specify that you'd like to sync using Backbone.tabletopSync
	       Need to specify a tabletop key and sheet
	      */
	      var CameraCollection = Backbone.Collection.extend({
	          // Reference to this collection's model.
	          model: Cam,
	          tabletop: {
	            instance: storage,
	            sheet: 'DucaCamChart'
	          },
	          sync: Backbone.tabletopSync
	      });

	      var CameraView = Backbone.View.extend({
	          tagname: 'div',
	          template: _.template($('#cam-template').html()),

	          render: function() {
	            $(this.el).html(this.template(this.model.toJSON()));
	            return this;
	          }
	      })
	    </script>
	    <script type="text/javascript">

	      /*
	        You need to initialize Tabletop before you do aaaaanything.
	        You might think it'd be a good idea to put that into backbone.tabletopSync,
	          but IMHO the fact that you could put the key/url into any model anywhere
	          ever sounds like trouble.
	      */
	      $(document).ready( function() {
	        var cameras = new CameraCollection();
	        cameras.fetch({ success: showInfo });
	      });
	      
	      function showInfo(cameras) {
	        var henry_view = new CameraView({ model: cameras.get('Aja') });

	        $("#content").append( henry_view.render().el );

	        var bosco_view = new CameraView({ model: cameras.get('Red') });

	        $("#content").append( bosco_view.render().el );

	        var thomas_view = new CameraView({ model: cameras.get('Canon') });

	        $("#content").append( thomas_view.render().el );
	        
	        /*
	          NOT WORKING, NOT SURE WHY.
	          
	          Fetching on models works as long as you've specified a sheet
	          and an idAttribute for the Backbone.Model (you can always
	          use rowNumber, it comes baked in to Tabletop)
	        */
	        thomas = new Cam({name: 'Thomas'})
	        thomas.fetch();

	        var thomas_view = new CameraView({ model: thomas });
	        $("#content").append( thomas_view.render().el );
	      }
	    
	      document.write("The published spreadsheet is located at <a target='_new' href='" + public_spreadsheet_url + "'>" + public_spreadsheet_url + "</a>");    
	    </script>
	</body>
</html>
